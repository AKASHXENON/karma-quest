<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karma Quest by Xenon | Arrow Adventure Game</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header with Neon Effect */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            border: 2px solid #00ffea;
            box-shadow: 0 0 30px rgba(0, 255, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header:before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff0080, #00ffea, #ff0080);
            z-index: -1;
            border-radius: 22px;
            animation: borderGlow 3s linear infinite;
        }

        @keyframes borderGlow {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(360deg); }
        }

        .game-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.8rem;
            font-weight: 900;
            background: linear-gradient(to right, #00ffea, #ff0080, #00ffea);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 20px rgba(0, 255, 234, 0.5);
            letter-spacing: 2px;
            margin-bottom: 10px;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { text-shadow: 0 0 20px rgba(0, 255, 234, 0.5); }
            to { text-shadow: 0 0 30px rgba(255, 0, 128, 0.5); }
        }

        .developer {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: #00ffea;
            font-weight: 700;
            letter-spacing: 3px;
            margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(0, 255, 234, 0.7);
        }

        .tagline {
            font-size: 1.2rem;
            color: #a0e7ff;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Stats Bar */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(0, 255, 234, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            border-color: #00ffea;
            box-shadow: 0 10px 20px rgba(0, 255, 234, 0.2);
        }

        .stat-box:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 234, 0.1), transparent);
            transition: left 0.5s;
        }

        .stat-box:hover:before {
            left: 100%;
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            color: #00ffea;
            text-shadow: 0 0 10px rgba(0, 255, 234, 0.7);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #a0e7ff;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        /* Game Container */
        .game-wrapper {
            position: relative;
            width: 100%;
            height: 550px;
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #000428, #004e92);
        }

        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            display: none;
        }

        .overlay-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 4rem;
            color: #ff0080;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 0, 128, 0.7);
            animation: pulse 1.5s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }

        .overlay-subtitle {
            font-size: 1.8rem;
            color: #00ffea;
            margin-bottom: 30px;
        }

        /* Controls */
        .controls-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(45deg, #ff0080, #00ffea);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 50px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
            min-width: 180px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .control-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .control-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }

        .control-btn:hover:before {
            left: 100%;
        }

        .control-btn:active {
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .control-btn-primary {
            background: linear-gradient(45deg, #00ffea, #0080ff);
        }

        .control-btn-warning {
            background: linear-gradient(45deg, #ff0080, #ff8000);
        }

        /* Mobile Controls */
        .mobile-controls {
            display: none;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
            margin-bottom: 30px;
        }

        .mobile-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(0, 255, 234, 0.2);
            border: 2px solid #00ffea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: #00ffea;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 0 20px rgba(0, 255, 234, 0.3);
        }

        .mobile-btn:active {
            background: rgba(0, 255, 234, 0.4);
            transform: scale(0.95);
        }

        /* Instructions */
        .instructions-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 255, 234, 0.3);
        }

        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: #00ffea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title:before {
            content: "★";
            color: #ff0080;
        }

        .instructions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .instruction-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 20, 40, 0.5);
            border-radius: 10px;
            transition: transform 0.3s;
        }

        .instruction-item:hover {
            transform: translateX(10px);
            background: rgba(0, 40, 80, 0.7);
        }

        .instruction-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        .instruction-text {
            flex: 1;
        }

        .instruction-key {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(0, 255, 234, 0.2);
            border-radius: 5px;
            font-family: 'Orbitron', sans-serif;
            margin: 0 5px;
            border: 1px solid #00ffea;
        }

        /* Powerups Display */
        .powerups-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .powerup-card {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 2px solid;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .powerup-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .powerup-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .powerup-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            margin-bottom: 10px;
        }

        .powerup-desc {
            color: #a0e7ff;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 25px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            border-top: 2px solid #ff0080;
            margin-top: 20px;
            width: 100%;
        }

        .copyright {
            font-family: 'Orbitron', sans-serif;
            color: #00ffea;
            font-size: 1.1rem;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .disclaimer {
            color: #a0e7ff;
            font-size: 0.9rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .game-title {
                font-size: 2.8rem;
            }
            
            .developer {
                font-size: 1.4rem;
            }
            
            .game-wrapper {
                height: 450px;
            }
            
            .overlay-title {
                font-size: 3rem;
            }
            
            .mobile-controls {
                display: flex;
            }
        }

        @media (max-width: 480px) {
            .game-title {
                font-size: 2.2rem;
            }
            
            .game-wrapper {
                height: 400px;
            }
            
            .control-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .overlay-title {
                font-size: 2.5rem;
            }
        }

        /* Particle Background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #00ffea;
            border-radius: 50%;
            box-shadow: 0 0 10px #00ffea;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Particle Background -->
    <div class="particles" id="particles"></div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="game-title">KARMA QUEST</h1>
            <div class="developer">BY XENON</div>
            <p class="tagline">Embark on an epic arrow-collecting adventure! Race through cyberspace, collect up arrows, avoid down arrows, and become the ultimate Karma master!</p>
        </header>

        <!-- Stats -->
        <div class="stats-container">
            <div class="stat-box">
                <div class="stat-value" id="score">0</div>
                <div class="stat-label">KARMA POINTS</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="highScore">0</div>
                <div class="stat-label">HIGH SCORE</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="lives">3</div>
                <div class="stat-label">LIVES</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="speed">1.0x</div>
                <div class="stat-label">SPEED</div>
            </div>
        </div>

        <!-- Game Container -->
        <div class="game-wrapper">
            <canvas id="gameCanvas"></canvas>
            <div class="game-overlay" id="gameOverScreen">
                <h2 class="overlay-title">GAME OVER</h2>
                <p class="overlay-subtitle">Final Karma: <span id="finalScore" style="color:#00ffea;">0</span></p>
                <button class="control-btn control-btn-primary" id="restartButton">PLAY AGAIN</button>
            </div>
        </div>

        <!-- Mobile Controls -->
        <div class="mobile-controls">
            <div class="mobile-btn" id="leftBtn">←</div>
            <div class="mobile-btn" id="jumpBtn">↑</div>
            <div class="mobile-btn" id="rightBtn">→</div>
        </div>

        <!-- Game Controls -->
        <div class="controls-container">
            <button class="control-btn control-btn-primary" id="startButton">▶ START QUEST</button>
            <button class="control-btn" id="pauseButton" disabled>⏸ PAUSE</button>
            <button class="control-btn control-btn-warning" id="howToButton">❓ HOW TO PLAY</button>
        </div>

        <!-- Instructions -->
        <div class="instructions-container" id="instructionsPanel">
            <h3 class="section-title">HOW TO PLAY</h3>
            <div class="instructions-grid">
                <div class="instruction-item">
                    <div class="instruction-icon" style="background:rgba(0,255,234,0.2); color:#00ffea;">←→</div>
                    <div class="instruction-text">
                        <strong>Move:</strong> Use <span class="instruction-key">←</span> and <span class="instruction-key">→</span> arrow keys to move left and right
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon" style="background:rgba(255,0,128,0.2); color:#ff0080;">↑</div>
                    <div class="instruction-text">
                        <strong>Jump:</strong> Press <span class="instruction-key">SPACE</span> or <span class="instruction-key">↑</span> to jump over obstacles
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon" style="color:#00ffea;">▲</div>
                    <div class="instruction-text">
                        <strong>Collect:</strong> Grab <span style="color:#00ffea">▲ Up Arrows</span> for +10 Karma
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon" style="color:#ff0080;">▼</div>
                    <div class="instruction-text">
                        <strong>Avoid:</strong> Dodge <span style="color:#ff0080">▼ Down Arrows</span> or lose a life
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon" style="color:#ffff00;">★</div>
                    <div class="instruction-text">
                        <strong>Power-ups:</strong> Collect <span style="color:#ffff00">★ Stars</span> for special abilities
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon" style="color:#46d160;">♦</div>
                    <div class="instruction-text">
                        <strong>Bonus:</strong> Grab <span style="color:#46d160">♦ Gold Arrows</span> for +50 Karma
                    </div>
                </div>
            </div>
        </div>

        <!-- Powerups Info -->
        <div class="powerups-container">
            <div class="powerup-card" style="border-color:#00ffea;">
                <div class="powerup-icon" style="color:#00ffea;">▲</div>
                <h4 class="powerup-title">UP ARROW</h4>
                <p class="powerup-desc">Basic karma source. Collect for +10 points. Common but essential for your journey.</p>
            </div>
            <div class="powerup-card" style="border-color:#46d160;">
                <div class="powerup-icon" style="color:#46d160;">♦</div>
                <h4 class="powerup-title">GOLD ARROW</h4>
                <p class="powerup-desc">Rare treasure! Collect for +50 karma points. Glows with bonus energy.</p>
            </div>
            <div class="powerup-card" style="border-color:#ffff00;">
                <div class="powerup-icon" style="color:#ffff00;">★</div>
                <h4 class="powerup-title">SPEED STAR</h4>
                <p class="powerup-desc">Temporary speed boost! Makes you faster and harder to hit for 5 seconds.</p>
            </div>
            <div class="powerup-card" style="border-color:#ff0080;">
                <div class="powerup-icon" style="color:#ff0080;">▼</div>
                <h4 class="powerup-title">DOWN ARROW</h4>
                <p class="powerup-desc">Danger! Avoid at all costs. Contact loses 1 life. They move faster than up arrows.</p>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="copyright">© 2024 KARMA QUEST | CREATED BY XENON</div>
            <p class="disclaimer">
                This is an independent game not affiliated with, endorsed by, or connected to any social media platform. 
                "Karma Quest" is a fictional game created for entertainment purposes. All game mechanics and concepts are original creations.
            </p>
        </footer>
    </div>

    <script>
        // ==================== INITIALIZATION ====================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const particlesContainer = document.getElementById('particles');
        
        // UI Elements
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('highScore');
        const livesElement = document.getElementById('lives');
        const speedElement = document.getElementById('speed');
        const startButton = document.getElementById('startButton');
        const pauseButton = document.getElementById('pauseButton');
        const restartButton = document.getElementById('restartButton');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreElement = document.getElementById('finalScore');
        const howToButton = document.getElementById('howToButton');
        const instructionsPanel = document.getElementById('instructionsPanel');
        const jumpBtn = document.getElementById('jumpBtn');
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');

        // Create background particles
        function createParticles() {
            particlesContainer.innerHTML = '';
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particle.style.width = particle.style.height = (2 + Math.random() * 3) + 'px';
                particlesContainer.appendChild(particle);
            }
        }
        createParticles();

        // Set canvas size
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }

        // ==================== GAME STATE ====================
        let game = {
            running: false,
            paused: false,
            score: 0,
            highScore: localStorage.getItem('karmaQuestHighScore') || 0,
            lives: 3,
            speed: 1.0,
            groundHeight: 40,
            gameOver: false,
            level: 1,
            multiplier: 1
        };

        // ==================== PLAYER ====================
        const player = {
            x: 100,
            y: 0,
            width: 50,
            height: 70,
            velocityY: 0,
            velocityX: 0,
            jumpPower: 16,
            gravity: 0.8,
            isJumping: false,
            color: '#00ffea',
            glow: true,
            glowTimer: 0
        };

        // ==================== GAME OBJECTS ====================
        let upArrows = [];
        let goldArrows = [];
        let downArrows = [];
        let speedStars = [];
        let platforms = [];
        let particles = [];
        let powerUpActive = false;
        let powerUpTimer = 0;

        // ==================== INITIALIZE ====================
        function initGameObjects() {
            upArrows = [];
            goldArrows = [];
            downArrows = [];
            speedStars = [];
            platforms = [];
            particles = [];
            
            // Create initial platforms
            createPlatforms();
            
            // Set player position
            player.x = 100;
            player.y = canvas.height - game.groundHeight - player.height;
            player.velocityY = 0;
            player.velocityX = 0;
            player.isJumping = false;
            player.glowTimer = 0;
            
            // Reset power ups
            powerUpActive = false;
            powerUpTimer = 0;
        }

        function createPlatforms() {
            platforms = [];
            const platformCount = 6;
            const platformWidth = canvas.width / 3;
            
            for (let i = 0; i < platformCount; i++) {
                platforms.push({
                    x: Math.random() * (canvas.width - platformWidth),
                    y: canvas.height - game.groundHeight - (i * 130),
                    width: platformWidth,
                    height: 25,
                    color: i % 2 === 0 ? '#0088aa' : '#006688',
                    glow: i % 3 === 0
                });
            }
            
            // Ground platform
            platforms.push({
                x: 0,
                y: canvas.height - game.groundHeight,
                width: canvas.width,
                height: game.groundHeight,
                color: '#003366',
                glow: false
            });
        }

        // ==================== DRAWING FUNCTIONS ====================
        function drawPlayer() {
            // Draw glow effect
            if (player.glow || player.glowTimer > 0) {
                ctx.shadowColor = player.color;
                ctx.shadowBlur = 20;
                if (powerUpActive) {
                    ctx.shadowColor = '#ffff00';
                    ctx.shadowBlur = 30;
                }
            }
            
            // Draw body
            ctx.fillStyle = powerUpActive ? '#ffff00' : player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // Draw head
            ctx.beginPath();
            ctx.arc(player.x + player.width/2, player.y, 25, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw eyes
            ctx.fillStyle = '#000033';
            ctx.beginPath();
            ctx.arc(player.x + player.width/2 - 10, player.y - 5, 8, 0, Math.PI * 2);
            ctx.arc(player.x + player.width/2 + 10, player.y - 5, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw mouth (smile or straight based on powerup)
            ctx.beginPath();
            if (powerUpActive) {
                ctx.arc(player.x + player.width/2, player.y + 15, 10, 0, Math.PI, false);
                ctx.strokeStyle = '#ff0080';
            } else {
                ctx.arc(player.x + player.width/2, player.y + 10, 8, 0.2, Math.PI - 0.2, false);
                ctx.strokeStyle = '#ffffff';
            }
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Reset shadow
            ctx.shadowBlur = 0;
            
            // Draw name above player
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 12px Orbitron';
            ctx.textAlign = 'center';
            ctx.fillText('XENON', player.x + player.width/2, player.y - 10);
        }

        function drawUpArrow(x, y, size) {
            ctx.save();
            ctx.translate(x + size/2, y + size/2);
            
            // Glow effect
            ctx.shadowColor = '#00ffea';
            ctx.shadowBlur = 15;
            
            // Draw arrow
            ctx.fillStyle = '#00ffea';
            ctx.beginPath();
            ctx.moveTo(0, -size/2);
            ctx.lineTo(-size/3, size/4);
            ctx.lineTo(-size/6, size/4);
            ctx.lineTo(-size/6, size/2);
            ctx.lineTo(size/6, size/2);
            ctx.lineTo(size/6, size/4);
            ctx.lineTo(size/3, size/4);
            ctx.closePath();
            ctx.fill();
            
            // Draw plus sign
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(-size/12, -size/8, size/6, size/4);
            ctx.fillRect(-size/8, -size/12, size/4, size/6);
            
            ctx.restore();
        }

        function drawGoldArrow(x, y, size) {
            ctx.save();
            ctx.translate(x + size/2, y + size/2);
            
            // Glow effect
            ctx.shadowColor = '#46d160';
            ctx.shadowBlur = 20;
            
            // Draw golden arrow
            const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, size);
            gradient.addColorStop(0, '#ffff00');
            gradient.addColorStop(1, '#ffaa00');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.moveTo(0, -size/2);
            ctx.lineTo(-size/3, size/4);
            ctx.lineTo(-size/6, size/4);
            ctx.lineTo(-size/6, size/2);
            ctx.lineTo(size/6, size/2);
            ctx.lineTo(size/6, size/4);
            ctx.lineTo(size/3, size/4);
            ctx.closePath();
            ctx.fill();
            
            // Draw star in center
            ctx.fillStyle = '#ffffff';
            drawStar(0, 0, 5, size/4, size/8);
            
            ctx.restore();
        }

        function drawDownArrow(x, y, size) {
            ctx.save();
            ctx.translate(x + size/2, y + size/2);
            
            // Glow effect
            ctx.shadowColor = '#ff0080';
            ctx.shadowBlur = 15;
            
            // Draw arrow
            ctx.fillStyle = '#ff0080';
            ctx.beginPath();
            ctx.moveTo(0, size/2);
            ctx.lineTo(-size/3, -size/4);
            ctx.lineTo(-size/6, -size/4);
            ctx.lineTo(-size/6, -size/2);
            ctx.lineTo(size/6, -size/2);
            ctx.lineTo(size/6, -size/4);
            ctx.lineTo(size/3, -size/4);
            ctx.closePath();
            ctx.fill();
            
            // Draw minus sign
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(-size/8, -size/12, size/4, size/6);
            
            ctx.restore();
        }

        function drawSpeedStar(x, y, size) {
            ctx.save();
            ctx.translate(x + size/2, y + size/2);
            
            // Pulsing glow
            const pulse = Math.sin(Date.now() / 200) * 5 + 20;
            ctx.shadowColor = '#ffff00';
            ctx.shadowBlur = pulse;
            
            // Draw star with gradient
            const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, size);
            gradient.addColorStop(0, '#ffffff');
            gradient.addColorStop(1, '#ffff00');
            
            ctx.fillStyle = gradient;
            drawStar(0, 0, 5, size/2, size/4);
            
            // Draw "S" in center
            ctx.fillStyle = '#000000';
            ctx.font = 'bold ' + (size/3) + 'px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('S', 0, 0);
            
            ctx.restore();
        }

        function drawStar(cx, cy, spikes, outerRadius, innerRadius) {
            let rot = Math.PI / 2 * 3;
            let x = cx;
            let y = cy;
            let step = Math.PI / spikes;

            ctx.beginPath();
            ctx.moveTo(cx, cy - outerRadius);

            for (let i = 0; i < spikes; i++) {
                x = cx + Math.cos(rot) * outerRadius;
                y = cy + Math.sin(rot) * outerRadius;
                ctx.lineTo(x, y);
                rot += step;

                x = cx + Math.cos(rot) * innerRadius;
                y = cy + Math.sin(rot) * innerRadius;
                ctx.lineTo(x, y);
                rot += step;
            }

            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
            ctx.fill();
        }

        function drawPlatforms() {
            platforms.forEach(platform => {
                // Platform glow
                if (platform.glow) {
                    ctx.shadowColor = '#00aaff';
                    ctx.shadowBlur = 10;
                }
                
                // Platform with gradient
                const gradient = ctx.createLinearGradient(platform.x, platform.y, platform.x, platform.y + platform.height);
                gradient.addColorStop(0, platform.color);
                gradient.addColorStop(1, '#001133');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                
                // Platform pattern
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                for (let i = 0; i < platform.width; i += 30) {
                    ctx.fillRect(platform.x + i, platform.y, 15, 5);
                }
                
                ctx.shadowBlur = 0;
            });
        }

        function drawParticles() {
            particles.forEach((particle, index) => {
                particle.y += particle.speed;
                particle.life--;
                
                if (particle.life <= 0) {
                    particles.splice(index, 1);
                    return;
                }
                
                ctx.globalAlpha = particle.life / 100;
                ctx.fillStyle = particle.color;
                ctx.fillRect(particle.x, particle.y, particle.size, particle.size);
            });
            ctx.globalAlpha = 1;
        }

        function createParticleEffect(x, y, color, count = 10) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    size: Math.random() * 5 + 2,
                    speed: Math.random() * 5 - 2.5,
                    color: color,
                    life: 100
                });
            }
        }

        // ==================== GAME LOGIC ====================
        function generateObjects() {
            // Up arrows
            if (Math.random() < 0.04) {
                upArrows.push({
                    x: Math.random() * (canvas.width - 40),
                    y: -40,
                    width: 40,
                    height: 40,
                    speed: 3 + game.speed,
                    rotation: 0
                });
            }
            
            // Gold arrows (rare)
            if (Math.random() < 0.01) {
                goldArrows.push({
                    x: Math.random() * (canvas.width - 50),
                    y: -50,
                    width: 50,
                    height: 50,
                    speed: 4 + game.speed,
                    rotation: 0
                });
            }
            
            // Down arrows
            if (Math.random() < 0.03) {
                downArrows.push({
                    x: Math.random() * (canvas.width - 40),
                    y: -40,
                    width: 40,
                    height: 40,
                    speed: 5 + game.speed,
                    rotation: 0
                });
            }
            
            // Speed stars (rare)
            if (Math.random() < 0.008) {
                speedStars.push({
                    x: Math.random() * (canvas.width - 40),
                    y: -40,
                    width: 40,
                    height: 40,
                    speed: 4 + game.speed
                });
            }
            
            // New platforms
            if (Math.random() < 0.01 && platforms.length < 12) {
                platforms.push({
                    x: Math.random() * (canvas.width - 200),
                    y: -50,
                    width: 150 + Math.random() * 100,
                    height: 25,
                    color: Math.random() > 0.5 ? '#0088aa' : '#006688',
                    glow: Math.random() > 0.7
                });
            }
        }

        function updateObjects() {
            // Update arrows
            upArrows.forEach((arrow, index) => {
                arrow.y += arrow.speed;
                arrow.rotation += 0.05;
                if (arrow.y > canvas.height) upArrows.splice(index, 1);
            });
            
            goldArrows.forEach((arrow, index) => {
                arrow.y += arrow.speed;
                arrow.rotation += 0.1;
                if (arrow.y > canvas.height) goldArrows.splice(index, 1);
            });
            
            downArrows.forEach((arrow, index) => {
                arrow.y += arrow.speed;
                arrow.rotation += 0.08;
                if (arrow.y > canvas.height) downArrows.splice(index, 1);
            });
            
            speedStars.forEach((star, index) => {
                star.y += star.speed;
                if (star.y > canvas.height) speedStars.splice(index, 1);
            });
            
            // Update platforms
            platforms.forEach((platform, index) => {
                if (game.running && !game.paused) {
                    platform.y += game.speed * 0.5;
                }
                if (platform.y > canvas.height + 100) {
                    platforms.splice(index, 1);
                }
            });
            
            // Update power-up timer
            if (powerUpActive) {
                powerUpTimer--;
                if (powerUpTimer <= 0) {
                    powerUpActive = false;
                    player.color = '#00ffea';
                }
            }
            
            // Update player glow
            if (player.glowTimer > 0) {
                player.glowTimer--;
            }
        }

        function checkCollisions() {
            // Check up arrow collisions
            upArrows.forEach((arrow, index) => {
                if (player.x < arrow.x + arrow.width &&
                    player.x + player.width > arrow.x &&
                    player.y < arrow.y + arrow.height &&
                    player.y + player.height > arrow.y) {
                    
                    game.score += 10 * game.multiplier;
                    scoreElement.textContent = game.score;
                    upArrows.splice(index, 1);
                    createParticleEffect(arrow.x + arrow.width/2, arrow.y + arrow.height/2, '#00ffea', 15);
                    player.glowTimer = 30;
                    
                    // Update high score
                    if (game.score > game.highScore) {
                        game.highScore = game.score;
                        highScoreElement.textContent = game.highScore;
                        localStorage.setItem('karmaQuestHighScore', game.highScore);
                    }
                }
            });
            
            // Check gold arrow collisions
            goldArrows.forEach((arrow, index) => {
                if (player.x < arrow.x + arrow.width &&
                    player.x + player.width > arrow.x &&
                    player.y < arrow.y + arrow.height &&
                    player.y + player.height > arrow.y) {
                    
                    game.score += 50 * game.multiplier;
                    scoreElement.textContent = game.score;
                    goldArrows.splice(index, 1);
                    createParticleEffect(arrow.x + arrow.width/2, arrow.y + arrow.height/2, '#ffff00', 25);
                    player.glowTimer = 60;
                }
            });
            
            // Check down arrow collisions
            downArrows.forEach((arrow, index) => {
                if (player.x < arrow.x + arrow.width &&
                    player.x + player.width > arrow.x &&
                    player.y < arrow.y + arrow.height &&
                    player.y + player.height > arrow.y) {
                    
                    game.lives--;
                    livesElement.textContent = game.lives;
                    downArrows.splice(index, 1);
                    createParticleEffect(arrow.x + arrow.width/2, arrow.y + arrow.height/2, '#ff0080', 20);
                    
                    if (game.lives <= 0) {
                        gameOver();
                    }
                }
            });
            
            // Check speed star collisions
            speedStars.forEach((star, index) => {
                if (player.x < star.x + star.width &&
                    player.x + player.width > star.x &&
                    player.y < star.y + star.height &&
                    player.y + player.height > star.y) {
                    
                    powerUpActive = true;
                    powerUpTimer = 300; // 5 seconds at 60fps
                    player.color = '#ffff00';
                    speedStars.splice(index, 1);
                    createParticleEffect(star.x + star.width/2, star.y + star.height/2, '#ffff00', 30);
                }
            });
            
            // Platform collisions
            let onPlatform = false;
            platforms.forEach(platform => {
                if (player.x + player.width > platform.x &&
                    player.x < platform.x + platform.width &&
                    player.y + player.height >= platform.y &&
                    player.y + player.height <= platform.y + 15 &&
                    player.velocityY >= 0) {
                    
                    player.y = platform.y - player.height;
                    player.velocityY = 0;
                    player.isJumping = false;
                    onPlatform = true;
                }
            });
            
            // Gravity
            if (!onPlatform && player.y + player.height < canvas.height - game.groundHeight) {
                player.velocityY += player.gravity;
                player.isJumping = true;
            } else if (!onPlatform && player.y + player.height >= canvas.height - game.groundHeight) {
                player.y = canvas.height - game.groundHeight - player.height;
                player.velocityY = 0;
                player.isJumping = false;
            }
            
            // Boundaries
            if (player.x < 0) player.x = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
            
            // Level progression
            game.level = Math.floor(game.score / 100) + 1;
            game.speed = 1 + (game.level * 0.2);
            game.multiplier = 1 + (game.level * 0.1);
            speedElement.textContent = game.speed.toFixed(1) + 'x';
        }

        function updatePlayer() {
            player.y += player.velocityY;
            player.x += player.velocityX;
            player.velocityX *= 0.85; // Friction
        }

        // ==================== GAME LOOP ====================
        function gameLoop() {
            if (!game.running || game.paused || game.gameOver) return;
            
            // Clear with gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#000428');
            gradient.addColorStop(1, '#004e92');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw stars in background
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            for (let i = 0; i < 50; i++) {
                const x = (i * 73) % canvas.width;
                const y = (i * 47) % canvas.height;
                const size = Math.sin(Date.now() / 1000 + i) * 1.5 + 1.5;
                ctx.fillRect(x, y, size, size);
            }
            
            // Update and draw
            updatePlayer();
            generateObjects();
            updateObjects();
            checkCollisions();
            
            drawPlatforms();
            drawParticles();
            
            // Draw objects
            upArrows.forEach(arrow => {
                ctx.save();
                ctx.translate(arrow.x + arrow.width/2, arrow.y + arrow.height/2);
                ctx.rotate(arrow.rotation);
                drawUpArrow(-arrow.width/2, -arrow.height/2, arrow.width);
                ctx.restore();
            });
            
            goldArrows.forEach(arrow => {
                ctx.save();
                ctx.translate(arrow.x + arrow.width/2, arrow.y + arrow.height/2);
                ctx.rotate(arrow.rotation);
                drawGoldArrow(-arrow.width/2, -arrow.height/2, arrow.width);
                ctx.restore();
            });
            
            downArrows.forEach(arrow => {
                ctx.save();
                ctx.translate(arrow.x + arrow.width/2, arrow.y + arrow.height/2);
                ctx.rotate(arrow.rotation);
                drawDownArrow(-arrow.width/2, -arrow.height/2, arrow.width);
                ctx.restore();
            });
            
            speedStars.forEach(star => {
                drawSpeedStar(star.x, star.y, star.width);
            });
            
            drawPlayer();
            
            // Draw HUD
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(10, 10, 250, 90);
            ctx.fillStyle = '#00ffea';
            ctx.font = 'bold 16px Orbitron';
            ctx.fillText(`LEVEL: ${game.level}`, 30, 35);
            ctx.fillText(`MULTIPLIER: ${game.multiplier.toFixed(1)}x`, 30, 60);
            ctx.fillText(`POWER-UP: ${powerUpActive ? 'ACTIVE' : 'INACTIVE'}`, 30, 85);
            
            // Continue loop
            requestAnimationFrame(gameLoop);
        }

        // ==================== GAME CONTROLS ====================
        function startGame() {
            if (game.gameOver) {
                resetGame();
            }
            
            game.running = true;
            game.paused = false;
            game.gameOver = false;
            
            startButton.disabled = true;
            pauseButton.disabled = false;
            pauseButton.textContent = '⏸ PAUSE';
            gameOverScreen.style.display = 'none';
            
            initGameObjects();
            gameLoop();
        }

        function togglePause() {
            if (!game.running) return;
            
            game.paused = !game.paused;
            pauseButton.textContent = game.paused ? '▶ RESUME' : '⏸ PAUSE';
            
            if (!game.paused) {
                gameLoop();
            }
        }

        function gameOver() {
            game.running = false;
            game.gameOver = true;
            
            startButton.disabled = false;
            pauseButton.disabled = true;
            
            finalScoreElement.textContent = game.score;
            gameOverScreen.style.display = 'flex';
            
            // Create explosion effect
            for (let i = 0; i < 50; i++) {
                createParticleEffect(
                    player.x + player.width/2,
                    player.y + player.height/2,
                    '#ff0080',
                    1
                );
            }
        }

        function resetGame() {
            game.score = 0;
            game.lives = 3;
            game.speed = 1.0;
            game.level = 1;
            game.multiplier = 1;
            game.gameOver = false;
            
            scoreElement.textContent = '0';
            livesElement.textContent = '3';
            speedElement.textContent = '1.0x';
            highScoreElement.textContent = game.highScore;
            
            initGameObjects();
        }

        // ==================== EVENT LISTENERS ====================
        const keys = {};
        
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            if (e.key === 'ArrowLeft') {
                player.velocityX = -12;
            } else if (e.key === 'ArrowRight') {
                player.velocityX = 12;
            } else if ((e.key === ' ' || e.key === 'ArrowUp') && !player.isJumping) {
                player.velocityY = -player.jumpPower;
                player.isJumping = true;
                createParticleEffect(player.x + player.width/2, player.y + player.height, '#00ffea', 8);
            } else if (e.key === 'p' || e.key === 'P') {
                togglePause();
            } else if (e.key === 'Escape') {
                if (game.running) togglePause();
            }
            
            if (e.key === ' ' || e.key === 'ArrowUp') {
                e.preventDefault();
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                player.velocityX = 0;
            }
        });

        // Mobile controls
        jumpBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (!player.isJumping && game.running) {
                player.velocityY = -player.jumpPower;
                player.isJumping = true;
                createParticleEffect(player.x + player.width/2, player.y + player.height, '#00ffea', 8);
            }
        });
        
        leftBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            player.velocityX = -12;
        });
        
        leftBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            player.velocityX = 0;
        });
        
        rightBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            player.velocityX = 12;
        });
        
        rightBtn.addEventListener('touchend', (e) => {
            e.preventDefault();
            player.velocityX = 0;
        });

        // Button events
        startButton.addEventListener('click', startGame);
        pauseButton.addEventListener('click', togglePause);
        restartButton.addEventListener('click', startGame);
        
        howToButton.addEventListener('click', () => {
            instructionsPanel.style.display = instructionsPanel.style.display === 'none' ? 'block' : 'none';
        });

        // Window resize
        window.addEventListener('resize', () => {
            resizeCanvas();
            createPlatforms();
        });

        // ==================== INITIALIZE ====================
        resizeCanvas();
        initGameObjects();
        
        // Initial draw
        gameLoop();
        
        // Show instructions by default
        instructionsPanel.style.display = 'block';
        
        console.log("🎮 Karma Quest by Xenon Loaded!");
        console.log("🚀 Ready for adventure! Press START QUEST to begin.");
    </script>
</body>
</html>